<h1>New Event</h1>
<hr>
<div class="col-md-6">
  <form #newEventForm="ngForm" (ngSubmit)="saveEvent(newEventForm.value)" autocomplete="off" novalidate>
    <div class="form-group" [ngClass]="{'error': newEventForm.controls.name?.invalid && newEventForm.controls.name?.touched}">
      <label for="eventName">Event Name:</label>
      <em *ngIf="newEventForm.controls.name?.invalid && (newEventForm.controls.name?.touched)">Required</em>
      <input (ngModel)="newEvent.name" name="name" required id="name" type="text" class="form-control" placeholder="Name of your event..." />
    </div>
    <div class="form-group" [ngClass]="{'error': newEventForm.controls.date?.invalid && newEventForm.controls.date?.touched}">
      <label for="eventDate">Event Date:</label>
      <em *ngIf="newEventForm.controls.date?.invalid && (newEventForm.controls.date?.touched)">Required</em>
      <input (ngModel)="newEvent.date" name="date" required id="eventDate" type="text" class="form-control" placeholder="format (mm/dd/yyyy)..." />
    </div>
    <div class="form-group" [ngClass]="{'error': newEventForm.controls.time?.invalid && newEventForm.controls.time?.touched}">
      <label for="eventTime">Event Time:</label>
      <em *ngIf="newEventForm.controls.time?.invalid && (newEventForm.controls.time?.touched)">Required</em>
      <input (ngModel)="newEvent.time" name="time" required id="eventTime" type="text" class="form-control" placeholder="start and end time..." />
    </div>
    <div class="form-group" [ngClass]="{'error': newEventForm.controls.price?.invalid && newEventForm.controls.price?.touched}">
      <label for="eventPrice">Event Price:</label>
      <em *ngIf="newEventForm.controls.price?.invalid && (newEventForm.controls.price?.touched)">Required</em>
      <input (ngModel)="newEvent.price" name="price" required id="eventPrice" type="text" type="number" class="form-control" placeholder="event price..." />
    </div>
    
    <div ngModelGroup="location" #locationGroup="ngModelGroup" validateLocation>
      <div class="form-group">
        <label for="address">Event Location:</label>
        <em *ngIf="locationGroup?.invalid && locationGroup?.touched">You must enter either the full location OR an online Url</em>
        <input (ngModel)="newEvent.address" name="address" id="address" type="text" class="form-control" placeholder="Address of event..." />
      </div>
      <div class="row">
        <div class="col-md-6">
          <input (ngModel)="newEvent.city" name="city" id="city" type="text" class="form-control" placeholder="City..." />
        </div>
        <div class="col-md-6" >
          <input (ngModel)="newEvent.country" name="country" id="country" type="text" class="form-control" placeholder="Country..." />
        </div>
      </div>
    </div>

    <div class="form-group">
      <label for="onlineUrl">Online Url:</label>
      <input (ngModel)="newEvent.onlineUrl" name="onlineUrl" id="onlineUrl" type="text" class="form-control" placeholder="Online Url..." (change)="locationGroup.control.controls.address.updateValueAndValidity()" />
    </div>
    <div class="form-group" [ngClass]="{'error': newEventForm.controls.imageUrl?.invalid && newEventForm.controls.imageUrl?.touched}">
      <label for="imageUrl">Image:</label>
      <em *ngIf="newEventForm.controls.imageUrl?.invalid && newEventForm.controls.imageUrl?.touched && newEventForm.controls.imageUrl?.errors.required">Required</em>
      <em *ngIf="newEventForm.controls.imageUrl?.invalid && newEventForm.controls.imageUrl?.touched  && newEventForm.controls.imageUrl?.errors.pattern">Must be a png or jpg url</em>
      <input (ngModel)="newEvent.imageUrl" name="imageUrl" required pattern=".*\/.*.(png|jpg)" id="imageUrl" type="text" class="form-control" placeholder="url of image..." />
      <img [src]="newEventForm.controls.imageUrl.value" *ngIf="newEventForm.controls.imageUrl?.valid" />
    </div>
    
    <button type="submit" [disabled]="newEventForm.invalid" class="btn btn-primary">Save</button>
    <button type="button" class="btn btn-default" (click)="cancel()">Cancel</button>
  </form>
</div>
<!--
13.08 Implementing a Multi-field Validator
We've now created our validator directive and added it to angular's list of validators. Let's save this change. But before we head to the browser, we need to check and possibly fix one item. Here in our CreateEvent HTML, way down at the bottom, way down here, we need to double check that the disabled attribute is being bound to the correct button. Here you can see that I've bound to the disabled attribute on the cancel button, but that actually needs to be on the save button. So that's where you have this disabled binding. We need to move it off the cancel button and up here to the save button. And we'll save that change as well, and now we can go back out to the browser. And refresh, the validator is going to be running, but it's not going to work correctly quite yet. Let's open the console and just keep that open and let's, I'm just going to use some garbage values in here. And now since none of these are filled in, this should not allow us to save, and we're seeing that's true, so let's fill in just the online URL, and we'll go back to our button. It's not valid yet, if we leave it's still not valid, so let's go in and add an address. And now our button is still not valid. So we've got a problem, our validator isn't quite working right yet. We need to fix this by giving the validator a little bit more information. Going back into the code, I'm going to go into the HTML. And up here where we created the validator and added it to this div, I'm going to mark this div as a model group. We've already got the ngModelGroup properties set, but I'm going to add that to a local ref variable called locationGroup. And I set that equal to ngModelGroup. So the syntax is a little bit weird here, here we're adding a property called ngModelGroup and setting it to location, and here we're adding a local ref locationGroup and setting it to ngModelGroup. What angular is doing is taking the model group and adding it to this ref so we can access it. Let's save that and we'll go back to the browser and refresh. And we'll try this again. Put in an address, and now you can see that our button is enabled. If I delete one of these values the button's disabled, if I put it in, the button's enabled. But what happens if we don't have an address and instead we have an online URL. Notice that the button is still not enabled. So our directive still isn't working correctly. And the reason for this is that the directive is on this address, which covers these three fields, and not on the online URL. So it has no idea when the online URL's value gets changed. We need to fix that. And there's a fairly simple way to do that. We're going to go down into our input box, and we're going to add an event handler on the change event. So I want a list of the change event, which is fired whenever the value of the input box changes. And what I want to do is take this location group that I've created up here, this ref. Refs are available not only in the node and its children, but also in sibling nodes. So here I can refer to that ref and I can access its control property which has an array of controls. The locationGroup refers to this div, this model group essentially, and the control would be the model group's control. And that has the control's array, which would be all of the three different input boxes, the address, the city and the country. And I just want to access one of those three controls. So I'm going to access the address control, and I want to tell it to reevaluate its validation. And I can do that with the updateValueAndValidity method. I just call that right here, and what this will do is every time the value of this input box changes, it will go up to the address control, which is right up here, this input box right here, and tell it rerun your validation which will then reevaluate the validation not only for this, but including this validator that we put up here, because that applies to this input box. It will revalidate it and now if this is valid, then the form will now show it's valid or invalid. So if I save that, we go back to the browser. Refresh our change, again more garbage data. Notice the save button's disabled. And if I tab out, that fires a change event, and now the save button's enabled. But if I go back in and remove this, and then tab out, the change fires, the save button's disabled, but I'm not given any information about what's going on. So let's add a little message that says hey you've got to have either the address or the online URL. So our validator's now working correctly but we just don't have feedback. That's pretty easy to fix. Here on the address, right after the event location, we're just going to add in a little emphasis tag, and we'll only show it if the location group, and that's this ref I created up here, let's make it nullable, it's invalid property is set, and the location group has been touched. We don't want this to show up if we've never touched any piece of the location group. So again, nullable, and then we'll put in an error message. Save that change, go back to the browser and refresh. And now I'll test this by giving it a value and then remove the value, and now we're getting our error message. You must set to either the full location or an online URL. So there we have it, we've got our error message working. We've got our validator working. It's a very strange and complex validator. We've had to touch a lot of different pieces of the form in order to make this work. There are other ways to skin this cat as well, but this is certainly one that works and it's a way to create a complex validator like this.
-->